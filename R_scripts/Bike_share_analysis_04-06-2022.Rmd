---
title: 'Case Study: How does Bike-Share Navigate Speedy Success?'
author: "Karthik Bhaktha"
date: "`r Sys.Date()`"
output: html_document
---

<img src="/Users/locco/Desktop/Google_Analytics_Course/Case_Studies/Case_Study_Bike_Sharing/R_scripts/cyclistic.png" title="Cyclistic Logo" width="134"/>

## Business Task: How do annual members and casual riders use Cyclistic bike differently?

**Scope of this analysis:**

To find patterns and trends in the data which could provide meaningful insight to the marketing. The insights gained from this analysis will be used by the marketing team to design a campaign that could target casual members to become annual members.

-   Casual riders: Customers who purchase *daily-pass* or *single-ride*.
-   Annual members: Customers who pay to use the service annually.

### Data:

**Source:** Publicly made available by Motivate International Inc. [here](https://divvy-tripdata.s3.amazonaws.com/index.html), under [license](https://www.divvybikes.com/data-license-agreement).

**Organization:** There are 12 data sets in csv format. Each data set represents one month of data from 03/2021 to 03/2022.

We merged the 13 data sets into a single dataframe using python. The data cleaning and modelling was performed in VScode Jupyter notebook.

In this R-notebook, we dive into the analysis while performing modelling the data as we go.

Loading all dependencies:

```{r Loading Dependencies, include=FALSE}
# loading dependicies required for the analysis
library(tidyverse)
library(skimr)
library(janitor)
library(ggplot2)
library(lubridate) 
require(scales)
library(ggridges)
  
```

After loading the dependencies we load the data on to a dataframe called `master_data`.

This is the data that has already been cleaned using python and stored the cleaned data as a csv file. Using `glimpse()` function to get an insight of the dataframe we just imported.

```{r Loading master_data}
#using read.csv to read the csv file and storing it in vector named master_data
master_data <- read.csv("/Users/locco/Desktop/Google_Analytics_Course/Case_Studies/Bike_share_Data/merged_csv.csv")

#glimpse of the dataset
glimpse(master_data)

#glimpse() provides a horizontal view of the dataframe. Beginning with the Number of rows and columns, followed by column name trailing '$' symbol, <data_type> and data....... 
```

There are 14 variables/columns (as seen above). For this analysis we will be working with mainly ride_id, started_at, rideable_type, member_casual,total_seconds, distance_miles.

Filtering and renaming couple of columns and storing it into a new vector trimmed_df

```{r Filtering and renaming columns}
trimmed_df <- master_data %>%
  select(ride_id, started_at, rideable_type, member_casual,total_seconds, distance_miles) %>%
  rename(ride_duration_seconds = total_seconds) %>% 
  rename(ride_distance_miles = distance_miles) %>% 
  rename(bike_type = rideable_type)

# checking if the desired funtions above were performed
glimpse(trimmed_df)
```

```{r}
#typecasting ride_distance_miles from type 'dbl' to 'int'
trimmed_df$ride_distance_miles <- as.integer(trimmed_df$ride_distance_miles)

#adding a ride_duration_min column
trimmed_df <- trimmed_df %>% 
  mutate(ride_duration_min = as.integer(ride_duration_seconds / 60))

#Checking if the typecasting was performed successfully
is_integer(trimmed_df$ride_distance_miles)
head(trimmed_df)
```

Now that we have cleaned the data further at a more granular level, we can play around with the data and explore it, gain some insights and find some patterns.

Performing descriptive analytics by Comparing annual and casual members based on the following criteria :

-   Number of rides by weekdays
-   Number of rides by month
-   Average time in min by weekdays
-   Average time in min y month
-   Type of bike used
-   (- `Type of ride by week and month ?`)

```{r}
#creating summary dataframe: grouping member_casual and weekday
summary_df <- trimmed_df %>% 
  mutate(weekday = wday(started_at, label = TRUE)) %>% 
  group_by(member_casual, weekday) %>% 
  summarise(number_of_rides = n(),
            average_duration_sec = mean(ride_duration_seconds),
            average_duration_min = mean(ride_duration_min),
            average_distance_miles = mean(ride_distance_miles)) %>% 
  arrange(member_casual,weekday)

View(summary_df)
  
```

```{r}
# Viz for number of rides taken every day of the week
summary_df %>% 
  ggplot(aes(x = weekday, y = number_of_rides, color = member_casual, fill = member_casual)) +
  geom_col(position =  "dodge") + scale_y_continuous(labels = comma)

```

```{r}
# Viz of average duration in minutes of rides spent every day of the week
summary_df %>% 
  ggplot(aes(x = weekday, y = average_duration_min, fill = member_casual)) +
  geom_col(position = "dodge") + scale_y_continuous(labels = comma)
```

```{r}
# Summary table grouping by month and member-casual
summary2_df <- trimmed_df %>% 
  mutate(month = month(started_at, abbr = FALSE ,label = TRUE)) %>%
  mutate(year = year(started_at)) %>% 
  group_by(member_casual, year, month) %>% 
  summarise(number_of_rides = n(),
            average_duration_sec = mean(ride_duration_seconds),
            average_duration_min = mean(ride_duration_min),
            average_distance_miles = mean(ride_distance_miles)) %>% 
  arrange(member_casual,year,month)

View(summary2_df)
```

```{r}
# Viz of number of ride spent every month
summary2_df %>% 
  ggplot(aes(x = month, y = number_of_rides, fill = member_casual)) +
  geom_col(position = "dodge") + scale_y_continuous(labels = comma) + 
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=0.5))
```

```{r}
# Viz of average minutes of ride spent every month
summary2_df %>% 
  ggplot(aes(x = month, y = average_duration_min, fill = member_casual)) +
  geom_col(position = "dodge") + scale_y_continuous(labels = comma) +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=0.5))
```

```{r}
# Creating Summary table, grouping the bike_type and member_casual
summary3_df <- trimmed_df %>% 
  mutate(month = month(started_at, abbr = FALSE ,label = TRUE)) %>% 
  group_by(member_casual, month, bike_type) %>% 
  summarise(number_of_rides = n(),
            average_duration_sec = mean(ride_duration_seconds),
            average_duration_min = mean(ride_duration_min),
            average_distance_miles = mean(ride_distance_miles)) %>% 
  arrange(member_casual,bike_type)

View(summary3_df)
```

```{r}
summary3_df %>% 
  ggplot(aes(x = month, y = number_of_rides, fill = bike_type)) +
  geom_col(position = "dodge") + scale_y_continuous(labels = comma) + theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=0.5)) + facet_grid(~ member_casual)

```

```{r}
summary3_df %>% 
  ggplot(aes(x = month, y = average_duration_min, fill = bike_type)) +
  geom_col(position = "dodge") + scale_y_continuous(labels = comma) + theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=0.5)) + facet_grid(~ member_casual)
```

```{r}
summary3_df %>% 
  ggplot(aes(x = average_duration_min, y = month, fill = stat(x))) +
  geom_density_ridges_gradient(scale = 3, rel_min_height = 0.01) +
  scale_fill_viridis_c(name = "test", option = "D") + scale_x_continuous(labels = comma)+ facet_grid(~member_casual)
```

```{r}
summary4_df <- trimmed_df %>% 
  mutate(weekday = wday(started_at, abbr = FALSE ,label = TRUE)) %>% 
  group_by(member_casual, weekday, bike_type) %>% 
  summarise(number_of_rides = n(),
            average_duration_sec = mean(ride_duration_seconds),
            average_duration_min = mean(ride_duration_min),
            average_distance_miles = mean(ride_distance_miles)) %>% 
  arrange(member_casual,bike_type)

View(summary3_df)
```
